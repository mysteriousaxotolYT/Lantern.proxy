<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Moderation Panel - Lantern Proxy</title>
    <style>
        /* [Your existing styles] */
    </style>
</head>
<body>
    <div class="top-bar">
        <!-- [Your existing navigation] -->
    </div>
    <div class="content">
        <h1>Moderation Panel</h1>
        <div class="moderation-content">
            <!-- [User management forms] -->
        </div>
    </div>
    <script src="https://unpkg.com/@supabase/supabase-js"></script>
    <script>
        const supabaseUrl = 'https://foklbwyrcnujwottmha.supabase.co';
        const supabaseKey = 'YOUR_SUPABASE_ANON_KEY'; // Replace with your anon key
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        async function checkAuth() {
            const session = JSON.parse(localStorage.getItem('supabase.auth.token'));
            if (!session) {
                window.location.href = 'index.html';
                return;
            }
            supabase.auth.setAuth(session.access_token);
        }

        checkAuth();

        async function addUser() {
            const username = document.getElementById('newUsername').value.trim();
            const password = document.getElementById('newPassword').value;
            const email = `${username}@lantern.learnhelp.cc`;

            const { user, error } = await supabase.auth.signUp({
                email: email,
                password: password,
            });

            if (error) {
                alert('Error adding user: ' + error.message);
                return;
            }

            // Insert into profiles table
            const { error: profileError } = await supabase.from('profiles').insert([
                {
                    id: user.id,
                    username: username,
                    is_banned: false,
                },
            ]);

            if (profileError) {
                alert('Error creating user profile: ' + profileError.message);
                return;
            }

            alert('User added successfully');
        }

        async function banUser() {
            const username = document.getElementById('banUsername').value.trim();

            const { data: profile, error } = await supabase
                .from('profiles')
                .select('id')
                .eq('username', username)
                .single();

            if (error) {
                alert('User not found: ' + error.message);
                return;
            }

            const { error: updateError } = await supabase
                .from('profiles')
                .update({ is_banned: true })
                .eq('id', profile.id);

            if (updateError) {
                alert('Error banning user: ' + updateError.message);
            } else {
                alert('User banned successfully');
            }
        }

        // Implement 'unbanUser', 'blockSignIns', 'unblockSignIns' similarly
    </script>
</body>
</html>
